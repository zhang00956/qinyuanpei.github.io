<!DOCTYPE html>
<html>
<head>
    

    
<!-- Tencent Speed -->
<script>var _speedMark = new Date()</script>
<!-- End Tencent Speed -->
<!-- Tencent Analysis -->
<script async src="//tajs.qq.com/stats?sId=65355341"></script>
<!-- End Tencent Analysis -->


    



    <meta charset="utf-8">
    <!-- HTTP 1.1 -->  
    <meta http-equiv="pragma" content="no-cache">  
    <!-- HTTP 1.0 -->  
    <meta http-equiv="cache-control" content="no-cache">
    
    
    
    <title>
        Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载 - Payne&#39;s Blog
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Unity3D,动态加载,AssetBundle">
    <meta name="description" content="&amp;emsp;&amp;emsp;各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://qinyuanpei.com。 今天我想和大家聊聊在Unity3D中关于场景的动态加载的问题。众所周知在Unity3D游戏开发过程中，因为受到游戏容量、平台性能和热更新等诸多因素的限制，我们可能无法将所有的游戏场景打包到项目中然后相对”静态”地加载，那么这个时候就需要我们使用动态加载的方式来将游">
<meta name="keywords" content="Unity3D,动态加载,AssetBundle">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载">
<meta property="og:url" content="http://qinyuanpei.github.io/posts/1467630055/index.html">
<meta property="og:site_name" content="Payne&#39;s Blog">
<meta property="og:description" content="&amp;emsp;&amp;emsp;各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://qinyuanpei.com。 今天我想和大家聊聊在Unity3D中关于场景的动态加载的问题。众所周知在Unity3D游戏开发过程中，因为受到游戏容量、平台性能和热更新等诸多因素的限制，我们可能无法将所有的游戏场景打包到项目中然后相对”静态”地加载，那么这个时候就需要我们使用动态加载的方式来将游">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-05-22T01:19:41.885Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载">
<meta name="twitter:description" content="&amp;emsp;&amp;emsp;各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://qinyuanpei.com。 今天我想和大家聊聊在Unity3D中关于场景的动态加载的问题。众所周知在Unity3D游戏开发过程中，因为受到游戏容量、平台性能和热更新等诸多因素的限制，我们可能无法将所有的游戏场景打包到项目中然后相对”静态”地加载，那么这个时候就需要我们使用动态加载的方式来将游">
    
        <link rel="alternate" type="application/atom+xml" title="Payne&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="stylesheet" href="/assets/styles/style.css?v=1.7.1">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/assets/images/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/assets/images/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Payne</h5>
          <a href="mailto:qinyuanpei@163.com" title="qinyuanpei@163.com" class="mail">qinyuanpei@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/books"  >
                <i class="icon icon-lg icon-bookmark"></i>
                读书
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/movies"  >
                <i class="icon icon-lg icon-film"></i>
                电影
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/works"  >
                <i class="icon icon-lg icon-code"></i>
                作品
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载</h1>
        <h5 class="subtitle">
            
                <time datetime="2015-06-15T07:24:17.000Z" itemprop="datePublished" class="page-time">
  2015-06-15
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/游戏开发/">游戏开发</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
<article id="post-Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载</h1>
        <div class="post-meta">
            <time class="post-time" title="2015-06-15 07:24:17" datetime="2015-06-15T07:24:17.000Z"  itemprop="datePublished">2015-06-15</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/游戏开发/">游戏开发</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            
    <span>
        <i class="icon icon-clock-o"></i>
        20 min.
    </span>
    
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>&emsp;&emsp;各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是<a href="http://qinyuanpei.com" target="_blank" rel="noopener">http://qinyuanpei.com</a>。 今天我想和大家聊聊在Unity3D中关于场景的动态加载的问题。众所周知在Unity3D游戏开发过程中，因为受到游戏容量、平台性能和热更新等诸多因素的限制，我们可能无法将所有的游戏场景打包到项目中然后相对”静态”地加载，那么这个时候就需要我们使用动态加载的方式来将游戏场景加载到场景中。博主在研究了Unity3D动态加载的相关资料后发现，目前Unity3D中实现动态加载场景的方式主要有以下两种方式：<a id="more"></a></p>
<ul>
<li>使用BuildStreamedSceneAssetBundle()方法将场景打包为AssetBundle：这种方法将生成一个流式的.unity3d文件，从而实现按需下载和加载，因此这种方式特别适合Web环境下游戏场景的加载，因为在Web环境下我们可以希望的是玩家可以在玩游戏的同时加载游戏。可是因为这种打包方式仅仅是保证了场景中的GameObject与本地资源的引用关系而非是将本地资源打包，因此从减少游戏容量的角度来说并不是十分实用，而且当我们使用WWW下载完AssetBundle后，需要使用Application.Load()方法来加载场景，我们知道在Unity3D中加载一个关卡(场景)是需要在BuildSetting中注册关卡的，因此在使用这种方式动态加载的时候请注意到这一点。</li>
</ul>
<ul>
<li>将场景内的所有物体打包为AssetBundle配合相关配置文件动态生成场景：这种方法的思路是使用一个配置文件来记录下当前场景中所有物体的位置、旋转和缩放信息，然后再根据配置文件使用Instantiate方法逐个生成即可。这种思路是考虑到需要在一个场景中动态替换GameObject或者是动态生成GameObject的情形，使用这种方法首先要满足一个条件，即：场景内所有的物体都是预制件(Prefab)。这是由Unity3D的机制决定的，因为Prefab是一个模板，当你需要动态生成一个物体的时候就需要为其提供一个模板(Prefab)。</li>
</ul>
<p>&emsp;&emsp;如果你对这两种方式没有什么疑问的话，那么我觉得我们可以正式开始今天的内容了。既然今天的题目已然告诉大家是使用AssetBundle和Xml文件实现场景的动态加载，我相信大家已经明白我要使用那种方式了。好了，下面我们正式开始吧！</p>
<p>##准备工作<br>&emsp;&emsp;在实现场景的动态加载前，我们首先要在本地准备好一个游戏场景，然后做两件事情：</p>
<ul>
<li>将场景内的所有GameObject打包为AssetBundle</li>
<li>将场景内所有的GameObject的信息导出为Xml文件<br>做这两件事情的时候，相当于我们是在准备食材和菜谱，有了食材和菜谱我们就可以烹制出美味佳肴了。可是在做着两件事情前，我们还有一件更为重要的事情要做，那就是我们需要将场景中使用到的GameObject制作成预制体(Prefab)。因为在博主的印象中，Unity3D打包的最小粒度应该是Prefab，所以为了保险起见，我还是建议大家将场景中使用到的GameObject制作成预制体(Prefab)。那么问题来了，当我们将这些Prefab打包成AssetBundle后是否还需要本地的Prefab文件？这里博主一直迷惑，因为理论上当我们将这些Prefab打包成AssetBundle后，我们实例化一个物体的时候实际上是在使用AssetBundle的Load方法来获取该物体的一个模板，这个模板应该是存储在AssetBundle中的啊！因为我的笔记本使用的是免费版的Unity3D无法对此进行测试，所以如果想知道这个问题结果的朋友可以等我下周到公司以后测试了再做讨论(我不会告诉你公司无耻地使用了破解版)，当然如果有知道这个问题的答案的朋友欢迎给我留言啊，哈哈！这里就是想告诉大家要准备好场景中物体的预设体(Prefab),重要的事情说三遍!!!</li>
</ul>
<p>##将场景内物体打包为AssetBundle<br>&emsp;&emsp;Unity3D打包的相关内容这里就不展开说了，因为在官方API文档中都能找到详细的说明，虽然说Unity5.0中AssetBundle打包的方式发生了变化，不过考虑到大家都还在使用4.X的版本，所以等以后我用上了Unity5.0再说吧，哈哈！好了，下面直接给出代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[MenuItem(&quot;Export/ExportTotal----对物体整体打包&quot;)]</span><br><span class="line">static void ExportAll()</span><br><span class="line">&#123;</span><br><span class="line">	//获取保存路径</span><br><span class="line">	string savePath=EditorUtility.SaveFilePanel(&quot;输出为AssetBundle&quot;,&quot;&quot;,&quot;New Resource&quot;,&quot;unity3d&quot;);</span><br><span class="line">	if(string.IsNullOrEmpty(savePath)) return;</span><br><span class="line">	//获取选择的物体</span><br><span class="line">	Object[] objs=Selection.GetFiltered(typeof(Object),SelectionMode.DeepAssets);</span><br><span class="line">	if(objs.Length&lt;0) return;</span><br><span class="line">	//打包</span><br><span class="line">	BuildPipeline.BuildAssetBundle(null,objs,savePath,BuildAssetBundleOptions.CollectDependencies|BuildAssetBundleOptions.CompleteAssets);</span><br><span class="line">	AssetDatabase.Refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##将场景内物体信息导出为Xml文件<br>&emsp;&emsp;导出场景内物体信息需要遍历场景中的每个游戏物体，因为我们在制作场景的时候通常会用一个空的GameObject作为父物体来组织场景中的各种物体，因此我们在导出Xml文件的时候仅仅考虑导出这些父物体，因为如果考虑子物体的话，可能会涉及到递归，整个问题将变得特别复杂。为了简化问题，我们这里仅仅考虑场景中的父物体。好了，开始写代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[MenuItem(&quot;Export/ExportScene----将当前场景导出为Xml&quot;)]</span><br><span class="line">static void ExportGameObjects()</span><br><span class="line">&#123;</span><br><span class="line">	//获取当前场景完整路径</span><br><span class="line">	string scenePath=EditorApplication.currentScene;</span><br><span class="line">	//获取当前场景名称</span><br><span class="line">	string sceneName=scenePath.Substring(scenePath.LastIndexOf(&quot;/&quot;)+1,scenePath.Length-scenePath.LastIndexOf(&quot;/&quot;)-1);</span><br><span class="line">	sceneName=sceneName.Substring(0,sceneName.LastIndexOf(&quot;.&quot;));</span><br><span class="line">	//获取保存路径</span><br><span class="line">	string savePath=EditorUtility.SaveFilePanel(&quot;输出场景内物体&quot;,&quot;&quot;,sceneName,&quot;xml&quot;);</span><br><span class="line">	//创建Xml文件</span><br><span class="line">	XmlDocument xmlDoc=new XmlDocument();</span><br><span class="line">	//创建根节点</span><br><span class="line">	XmlElement scene=xmlDoc.CreateElement(&quot;Scene&quot;);</span><br><span class="line">	scene.SetAttribute(&quot;Name&quot;,sceneName);</span><br><span class="line">	scene.SetAttribute(&quot;Asset&quot;,scenePath);</span><br><span class="line">	xmlDoc.AppendChild(scene);</span><br><span class="line">	//遍历场景中的所有物体</span><br><span class="line">	foreach(GameObject go in Object.FindObjectsOfType(typeof(GameObject)))</span><br><span class="line">	&#123;</span><br><span class="line">		//仅导出场景中的父物体</span><br><span class="line">		if(go.transform.parent==null)</span><br><span class="line">		&#123;</span><br><span class="line">			//创建每个物体</span><br><span class="line">			XmlElement gameObject=xmlDoc.CreateElement(&quot;GameObject&quot;);</span><br><span class="line">			gameObject.SetAttribute(&quot;Name&quot;,go.name);</span><br><span class="line">			gameObject.SetAttribute(&quot;Asset&quot;,&quot;Prefabs/&quot;+ go.name + &quot;.prefab&quot;);</span><br><span class="line">			//创建Transform</span><br><span class="line">			XmlElement transform=xmlDoc.CreateElement(&quot;Transform&quot;);</span><br><span class="line">			transform.SetAttribute(&quot;x&quot;,go.transform.position.x.ToString());</span><br><span class="line">			transform.SetAttribute(&quot;y&quot;,go.transform.position.y.ToString());</span><br><span class="line">			transform.SetAttribute(&quot;z&quot;,go.transform.position.z.ToString());</span><br><span class="line">			gameObject.AppendChild(transform);</span><br><span class="line">			//创建Rotation</span><br><span class="line">			XmlElement rotation=xmlDoc.CreateElement(&quot;Rotation&quot;);</span><br><span class="line">			rotation.SetAttribute(&quot;x&quot;,go.transform.eulerAngles.x.ToString());</span><br><span class="line">			rotation.SetAttribute(&quot;y&quot;,go.transform.eulerAngles.y.ToString());</span><br><span class="line">			rotation.SetAttribute(&quot;z&quot;,go.transform.eulerAngles.z.ToString());</span><br><span class="line">			gameObject.AppendChild(rotation);</span><br><span class="line">			//创建Scale</span><br><span class="line">			XmlElement scale=xmlDoc.CreateElement(&quot;Scale&quot;);</span><br><span class="line">			scale.SetAttribute(&quot;x&quot;,go.transform.localScale.x.ToString());</span><br><span class="line">			scale.SetAttribute(&quot;y&quot;,go.transform.localScale.y.ToString());</span><br><span class="line">			scale.SetAttribute(&quot;z&quot;,go.transform.localScale.z.ToString());</span><br><span class="line">			gameObject.AppendChild(scale);</span><br><span class="line">			//添加物体到根节点</span><br><span class="line">			scene.AppendChild(gameObject);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">	xmlDoc.Save(savePath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;好了，在这段代码中我们以Scene作为根节点，然后以每个GameObject作为Scene的子节点，重点在Xml文件中记录了每个GameObject的名称、Prefab、坐标、旋转和缩放等信息。下面是一个导出场景的Xml文件的部分内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Scene</span> <span class="attr">Name</span>=<span class="string">"DoneStealth"</span> <span class="attr">Asset</span>=<span class="string">"Assets/Done/DoneScenes/DoneStealth.unity"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GameObject</span> <span class="attr">Name</span>=<span class="string">"char_robotGuard_002"</span> <span class="attr">Asset</span>=<span class="string">"Prefabs/char_robotGuard_002.prefab"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Transform</span> <span class="attr">x</span>=<span class="string">"-18.99746"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">z</span>=<span class="string">"37.2443"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Rotation</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">z</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Scale</span> <span class="attr">x</span>=<span class="string">"1"</span> <span class="attr">y</span>=<span class="string">"1"</span> <span class="attr">z</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">GameObject</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GameObject</span> <span class="attr">Name</span>=<span class="string">"fx_laserFence_lasers_003"</span> <span class="attr">Asset</span>=<span class="string">"Prefabs/fx_laserFence_lasers_003.prefab"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Transform</span> <span class="attr">x</span>=<span class="string">"-17.90294"</span> <span class="attr">y</span>=<span class="string">"1.213998"</span> <span class="attr">z</span>=<span class="string">"24.07678"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Rotation</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"90.00001"</span> <span class="attr">z</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Scale</span> <span class="attr">x</span>=<span class="string">"1"</span> <span class="attr">y</span>=<span class="string">"1"</span> <span class="attr">z</span>=<span class="string">"3.735847"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">GameObject</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GameObject</span> <span class="attr">Name</span>=<span class="string">"door_generic_slide_001"</span> <span class="attr">Asset</span>=<span class="string">"Prefabs/door_generic_slide_001.prefab"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Transform</span> <span class="attr">x</span>=<span class="string">"-15.91264"</span> <span class="attr">y</span>=<span class="string">"-0.001293659"</span> <span class="attr">z</span>=<span class="string">"7.006886"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Rotation</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"90.00001"</span> <span class="attr">z</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Scale</span> <span class="attr">x</span>=<span class="string">"1"</span> <span class="attr">y</span>=<span class="string">"1"</span> <span class="attr">z</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">GameObject</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GameObject</span> <span class="attr">Name</span>=<span class="string">"door_generic_slide_003"</span> <span class="attr">Asset</span>=<span class="string">"Prefabs/door_generic_slide_003.prefab"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Transform</span> <span class="attr">x</span>=<span class="string">"-7.910765"</span> <span class="attr">y</span>=<span class="string">"-0.001293659"</span> <span class="attr">z</span>=<span class="string">"37.01304"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Rotation</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"90.00001"</span> <span class="attr">z</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Scale</span> <span class="attr">x</span>=<span class="string">"1"</span> <span class="attr">y</span>=<span class="string">"1"</span> <span class="attr">z</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">GameObject</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;在这里我们假设所有的Prefab是放置在Resources/Prefabs目录中的，那么此时我们便有了两种动态加载场景的方式</p>
<ul>
<li>通过每个GameObject的Asset属性，配合Resources.Load()方法实现动态加载</li>
<li>通过每个GameObject的Name属性，配合AssetBundle的Load()方法实现动态加载<br>这两种方法大同小异，区别仅仅在于是否需要从服务器下载相关资源。因此本文的主题是使用AssetBundle和Xml实现场景的动态加载，因此，接下来我们主要以第二种方式为主，第一种方式请大家自行实现吧！</li>
</ul>
<p>##动态加载物体到场景中<br>&emsp;&emsp;首先我们来定义一个根据配置文件动态加载AssetBundle中场景的方法LoadDynamicScene<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">/// 根据配置文件动态加载AssetBundle中的场景</span><br><span class="line">/// &lt;/summary&gt;</span><br><span class="line">/// &lt;param name=&quot;bundle&quot;&gt;从服务器上下载的AssetBundle文件&lt;/param&gt;</span><br><span class="line">/// &lt;param name=&quot;xmlFile&quot;&gt;AssetBundle文件对应的场景配置文件&lt;/param&gt;</span><br><span class="line">public static void LoadDynamicScene(AssetBundle bundle,string xmlFile)</span><br><span class="line">&#123;</span><br><span class="line">	//加载本地配置文件</span><br><span class="line">	XmlDocument xmlDoc=new XmlDocument();</span><br><span class="line">	xmlDoc.LoadXml(((TextAsset)Resources.Load(xmlFile)).text);</span><br><span class="line">	//读取根节点</span><br><span class="line">	XmlElement root=xmlDoc.DocumentElement;</span><br><span class="line">	if(root.Name==&quot;Scene&quot;)</span><br><span class="line">	&#123;</span><br><span class="line">		XmlNodeList nodes=root.SelectNodes(&quot;/Scene/GameObject&quot;);</span><br><span class="line">		//定义物体位置、旋转和缩放</span><br><span class="line">		Vector3 position=Vector3.zero;</span><br><span class="line">		Vector3 rotation=Vector3.zero;</span><br><span class="line">		Vector3 scale=Vector3.zero;</span><br><span class="line">		//遍历每一个物体</span><br><span class="line">		foreach(XmlElement xe1 in nodes)</span><br><span class="line">		&#123;</span><br><span class="line">			//遍历每一个物体的属性节点</span><br><span class="line">			foreach(XmlElement xe2 in xe1.ChildNodes)</span><br><span class="line">			&#123;</span><br><span class="line">				//根据节点名称为相应的变量赋值</span><br><span class="line">				if(xe2.Name==&quot;Transform&quot;)</span><br><span class="line">				&#123;</span><br><span class="line">					position=new Vector3(float.Parse(xe2.GetAttribute(&quot;x&quot;)),float.Parse(xe2.GetAttribute(&quot;y&quot;)),float.Parse(xe2.GetAttribute(&quot;z&quot;)));</span><br><span class="line">				&#125;else if(xe2.Name==&quot;Rotation&quot;)</span><br><span class="line">				&#123;</span><br><span class="line">					rotation=new Vector3(float.Parse(xe2.GetAttribute(&quot;x&quot;)),float.Parse(xe2.GetAttribute(&quot;y&quot;)),float.Parse(xe2.GetAttribute(&quot;z&quot;)));</span><br><span class="line">				&#125;else&#123;</span><br><span class="line">					scale=new Vector3(float.Parse(xe2.GetAttribute(&quot;x&quot;)),float.Parse(xe2.GetAttribute(&quot;y&quot;)),float.Parse(xe2.GetAttribute(&quot;z&quot;)));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			//生成物体</span><br><span class="line">			GameObject go=(GameObject)GameObject.Instantiate(bundle.Load(xe1.GetAttribute(&quot;Name&quot;)),position,Quaternion.Euler(rotation));</span><br><span class="line">			go.transform.localScale=scale;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;因为该方法中的AssetBundle是需要从服务器下载下来的，因此我们需要使用协程来下载AssetBundle：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IEnumerator Download()</span><br><span class="line">&#123;</span><br><span class="line">	WWW _www = new WWW (&quot;http://localhost/DoneStealth.unity3d&quot;);</span><br><span class="line">	yield return _www;</span><br><span class="line">	//检查是否发生错误</span><br><span class="line">	if (string.IsNullOrEmpty (_www.error)) </span><br><span class="line">	&#123;</span><br><span class="line">		//检查AssetBundle是否为空</span><br><span class="line">		if(_www.assetBundle!=null)</span><br><span class="line">		&#123;</span><br><span class="line">			LoadDynamicScene(_www.assetBundle,&quot;DoneStealth.xml&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;好了，现在运行程序，可以发现场景将被动态地加载到当前场景中:)，哈哈</p>
<p><img src="" alt=""></p>
<p>##小结</p>
<ul>
<li>使用这种方式来加载场景主要是为了提高游戏的性能，如果存在大量重复性的场景的时候，可以使用这种方式来减小游戏的体积，可是这种方式本质上是一种用时间换效率的方式，因为在使用这种方法前，我们首先要做好游戏场景，然后再导出相关的配置文件和AssetBundle，从根本上来讲，工作量其实没有减少。</li>
<li>当场景导出的Xml文件中的内容较多时，建议使用内存池来管理物体的生成和销毁，因为频繁的生成和销毁是会带来较大的内存消耗的。说到这里的时候，我不得不吐槽下公司最近的项目，在将近300个场景中只有30个场景是最终发布游戏时需要打包的场景，然后剩余场景将被用来动态地加载到场景中，因为领导希望可以实现动态改变场景的目的，更为郁闷的是整个场景要高度DIY,模型要能够随用户拖拽移动、旋转，模型和材质要能够让用户自由替换。从整体上来讲，频繁地销毁和生成物体会耗费大量资源，因此如果遇到这种情况建议还是使用内存池进行管理吧！</li>
</ul>
<p>&emsp;&emsp;好了，今天的内容就是这样子了，如果大家对此有什么疑问，欢迎给我留言，谢谢大家！</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        <p><b>版权声明：</b>
        <a href="http://qinyuanpei.github.io/posts/1467630055/" rel="external">Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载</a>
        ，由&nbsp;<a href="/about" target="_blank" rel="external">Payne</a>&nbsp;
        首次发表于&nbsp;<a href="/" target="_blank" rel="external">Payne's Blog</a>&nbsp;
        ，本文地址为：<a href="http://qinyuanpei.github.io/posts/1467630055/" target="_blank" rel="external">http://qinyuanpei.github.io/posts/1467630055/</a>
        ，转载请注明<b>作者</b>和<b>出处</b>。</p>
    </div>
    <footer>
        <a href="http://qinyuanpei.github.io">
            <img src="/assets/images/avatar.jpg" alt="Payne">
            Payne
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AssetBundle/">AssetBundle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/动态加载/">动态加载</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://qinyuanpei.github.io/posts/1467630055/&title=《Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载》 — Payne's Blog&pic=http://qinyuanpei.github.ioassets/images/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://qinyuanpei.github.io/posts/1467630055/&title=《Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载》 — Payne's Blog&source=&emsp;&emsp;各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://qinyuanpei.com。 今天我想和大家聊聊..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://qinyuanpei.github.io/posts/1467630055/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载》 — Payne's Blog&url=http://qinyuanpei.github.io/posts/1467630055/&via=http://qinyuanpei.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://qinyuanpei.github.io/posts/1467630055/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/posts/1059499448/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Unity3D游戏开发之路：一月工作总结</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/posts/1424645834/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Unity3D游戏开发之快速打造流行的关卡系统</h4>
      </a>
    </div>
  
</nav>



    
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script type="text/javascript"> 
    var gitalk = new Gitalk({ 
        clientID: '3b6c49ff50fcaac5021c', 
        clientSecret: '31ed8fc621160dc634a20b15a0f2ebd543d21c40', 
        id: '1467630055', 
        repo: 'qinyuanpei.github.io', 
        owner: 'qinyuanpei', 
        admin: 'qinyuanpei', 
        distractionFreeMode: 'true', 
    }) 
    gitalk.render('gitalk-container') 
    </script> 


</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        赠人玫瑰，手有余香
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/assets/images/geizan.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/assets/images/geizan.jpg" data-alipay="/assets/images/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>
                <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="license">
                    BY-NC-SA
                </a>
            </span>
            <span>
                <a href="https://www.travis-ci.org/qinyuanpei/qinyuanpei.github.io" rel="license">
                    Travis CI
                </a>
            </span>
            <span>
                <a href="https://github.com/qinyuanpei/qinyuanpei.github.io" rel="license">
                    Github
                </a>
            </span>
            <span>
                <a href="https://coding.net/u/qinyuanpei/p/qinyuanpei.coding.me" rel="license">
                    Coding
                </a>
            </span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Payne &copy; 2014 - 2018</span>
            <span>
                
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://qinyuanpei.github.io/posts/1467630055/&title=《Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载》 — Payne's Blog&pic=http://qinyuanpei.github.ioassets/images/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://qinyuanpei.github.io/posts/1467630055/&title=《Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载》 — Payne's Blog&source=&emsp;&emsp;各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://qinyuanpei.com。 今天我想和大家聊聊..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://qinyuanpei.github.io/posts/1467630055/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Unity3D游戏开发之使用AssetBundle和Xml实现场景的动态加载》 — Payne's Blog&url=http://qinyuanpei.github.io/posts/1467630055/&via=http://qinyuanpei.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://qinyuanpei.github.io/posts/1467630055/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://qinyuanpei.github.io/posts/1467630055/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.6/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/assets/scripts/main.min.js?v=1.7.1"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/assets/scripts/search.min.js?v=1.7.1" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
