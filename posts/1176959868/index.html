<!DOCTYPE html>
<html>
<head>
    

    
<!-- Tencent Speed -->
<script>var _speedMark = new Date()</script>
<!-- End Tencent Speed -->
<!-- Tencent Analysis -->
<script async src="//tajs.qq.com/stats?sId=65355341"></script>
<!-- End Tencent Analysis -->


    



    <meta charset="utf-8">
    <!-- HTTP 1.1 -->  
    <meta http-equiv="pragma" content="no-cache">  
    <!-- HTTP 1.0 -->  
    <meta http-equiv="cache-control" content="no-cache">
    
    
    
    <title>
        Unity3D塔防游戏开发项目讲解(下) - Payne&#39;s Blog
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Unity3D,游戏开发,塔防">
    <meta name="description" content="各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://blog.csdn.net/qinyuanpei。我们知道一个完整的塔防游戏由地图、敌人、防守单位三个部分组成，在上一篇文章中我们已经对地图这块儿进行了全面的讲解，今天我们来说说敌人和防守单位。">
<meta name="keywords" content="Unity3D,游戏开发,塔防">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity3D塔防游戏开发项目讲解(下)">
<meta property="og:url" content="http://qinyuanpei.github.io/posts/1176959868/index.html">
<meta property="og:site_name" content="Payne&#39;s Blog">
<meta property="og:description" content="各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://blog.csdn.net/qinyuanpei。我们知道一个完整的塔防游戏由地图、敌人、防守单位三个部分组成，在上一篇文章中我们已经对地图这块儿进行了全面的讲解，今天我们来说说敌人和防守单位。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://img.blog.csdn.net/20150301184316413">
<meta property="og:image" content="http://img.blog.csdn.net/20150301190040972">
<meta property="og:updated_time" content="2018-06-04T06:11:50.620Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity3D塔防游戏开发项目讲解(下)">
<meta name="twitter:description" content="各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://blog.csdn.net/qinyuanpei。我们知道一个完整的塔防游戏由地图、敌人、防守单位三个部分组成，在上一篇文章中我们已经对地图这块儿进行了全面的讲解，今天我们来说说敌人和防守单位。">
<meta name="twitter:image" content="http://img.blog.csdn.net/20150301184316413">
    
        <link rel="alternate" type="application/atom+xml" title="Payne&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="stylesheet" href="/assets/styles/style.css?v=1.7.1">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/assets/images/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/assets/images/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Payne</h5>
          <a href="mailto:qinyuanpei@163.com" title="qinyuanpei@163.com" class="mail">qinyuanpei@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/books"  >
                <i class="icon icon-lg icon-bookmark"></i>
                读书
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/movies"  >
                <i class="icon icon-lg icon-film"></i>
                电影
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/works"  >
                <i class="icon icon-lg icon-code"></i>
                作品
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Unity3D塔防游戏开发项目讲解(下)</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Unity3D塔防游戏开发项目讲解(下)</h1>
        <h5 class="subtitle">
            
                <time datetime="2015-01-21T13:50:48.000Z" itemprop="datePublished" class="page-time">
  2015-01-21
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/游戏开发/">游戏开发</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#敌人篇"><span class="post-toc-number">1.</span> <span class="post-toc-text">敌人篇</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#敌人自动寻路的实现"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">敌人自动寻路的实现</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#敌人按波次进攻的实现"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">敌人按波次进攻的实现</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#防守单位篇"><span class="post-toc-number">2.</span> <span class="post-toc-text">防守单位篇</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-Unity3D塔防游戏开发项目讲解(下)"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Unity3D塔防游戏开发项目讲解(下)</h1>
        <div class="post-meta">
            <time class="post-time" title="2015-01-21 13:50:48" datetime="2015-01-21T13:50:48.000Z"  itemprop="datePublished">2015-01-21</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/游戏开发/">游戏开发</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            
    <span>
        <i class="icon icon-clock-o"></i>
        33 min.
    </span>
    
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是<a href="http://blog.csdn.net/qinyuanpei" target="_blank" rel="noopener">http://blog.csdn.net/qinyuanpei</a>。我们知道一个完整的塔防游戏由地图、敌人、防守单位三个部分组成，在上一篇文章中我们已经对地图这块儿进行了全面的讲解，今天我们来说说敌人和防守单位。</p>
<a id="more"></a>
<h1 id="敌人篇"><a href="#敌人篇" class="headerlink" title="敌人篇"></a>敌人篇</h1><h2 id="敌人自动寻路的实现"><a href="#敌人自动寻路的实现" class="headerlink" title="敌人自动寻路的实现"></a>敌人自动寻路的实现</h2><p>敌人在游戏中有一个基本的行为，即沿着寻路路径向我方阵地移动并发起攻击。在地图篇中，我们详细地介绍了敌人寻路路径的生成原理。既然有了敌人寻路的路线，那么怎么让敌人沿着路线移动呢？其实只要指定敌人寻路的起点就可以了，因为在寻路路径的设计中，我们使用的是一个类似于链表的结构，这样我们就能根据每个结点获取它的目标结点，从而实现敌人沿着寻路路径移动的效果了。因为敌人寻路的路线是定义在PathNode类中的，因此我们可以写出下面这样的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">void Move()</span><br><span class="line">&#123;</span><br><span class="line">	Vector3 mPos1=this.transform.position;</span><br><span class="line">	Vector3 mPos2=this.StartNode.transform.position;</span><br><span class="line">	//计算敌人与路径节点间的距离</span><br><span class="line">	float mDis=Vector2.Distance(new Vector2(mPos1.x,mPos1.y),new Vector2(mPos2.x,mPos2.y));</span><br><span class="line">	if(mDis&lt;0.1F)&#123;</span><br><span class="line">		if(StartNode.ThatNode==null)&#123;</span><br><span class="line">			//对防守阵地进行摧毁</span><br><span class="line">			GameManager.Instance.PlayerHP-=20;</span><br><span class="line">			//从敌人列表中移除自身</span><br><span class="line">			GameManager.Instance.Enemys.Remove(this);</span><br><span class="line">			//销毁自身</span><br><span class="line">			Destroy(this.gameObject);</span><br><span class="line">			//销毁血条</span><br><span class="line">			Destroy(mHPBar.gameObject);</span><br><span class="line">			&#125;else&#123;</span><br><span class="line">			StartNode=StartNode.ThatNode;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	//计算敌人的移动方向</span><br><span class="line">	Vector3 mDir=new Vector3(mPos2.x-mPos1.x,mPos2.y-mPos1.y,0).normalized;</span><br><span class="line">	transform.Translate(mDir * MoveSpeed * Time.deltaTime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>好了，现在我们来一起分析这段代码。首先，我们计算了敌人与路径结点间的距离，这里我们用0.1来近似地表示敌人已经到了路径结点上，此时如果该结点的目标结点为null则表示此时敌人已经到了最后一个结点处，所以敌人会对我方的阵地造成20点的伤害并销毁敌人。在GameManager我们使用了一个列表来管理和维护当前场景中的所有敌人，因此当当前敌人销毁时需要从列表中移除，GameManager类是一个静态类，负责对游戏的全局维护，这个类我们放到稍后来讲啊。那么如果敌人没有走到最后一个结点怎么办呢？我们只需要将StartNode指向StartNode的目标节点，这样我们就可以对整个路径结点实现遍历。这里是不是有种数据结构的感觉呢？哈哈，数据结构和算法是编程中最基础、最重要的内容，这些内容到了游戏开发领域同样是适用的。那么，好了，既然知道敌人是怎么移动的，现在我们就来对敌人进行移动吧，这里是采用计算移动方向的方式来实现，这个很简单啦。</p>
<p>好了，现在我们来说说敌人的血条吧，我们知道当怪物沿着寻路路径向我方阵地发起攻击的时候，我方防守单位会自动地对敌人进行防御性攻击，那么此时血条就可以显示敌人的实时血量，从而方便玩家根据战场的情况来调整兵力部署情况。我们知道从Unity4.6以后Unity开始使用全新的GUI系统UGUI，因为博主在之前的项目中一直使用NGUI，加上博主不是很喜欢做UI，所以每次用NGUI的时候整个人的心情都是不好的，有段时间被NGUI虐得体无完肤，感觉整个人都不好了。好了，既然现在我们有了新的选择UGUI，那么就让我们先睹为快吧！如图，全新的NGUI位于GameObect-&gt;UI菜单下，基本覆盖了常用的如Button、Image、Slider、ScrollBar等控件，因为UGUI刚推出不久，所以博主希望大家还是能客观、公正的对待UGUI和NGUI，博主认为在短期内这两个GUI系统将处于共存的状态，不存在相互替代的可能性。<br><img src="http://img.blog.csdn.net/20150301184316413" alt="UGUI"><br> 好了，UGUI所有的控件都是放到一个叫做Canvas的父控件下的，这一点和NGUI的UIRoot有些类似吧！Canvas提供了三种模式的UI系统，即Screen Space-Overlay、Screen Space-Camera、World Space。第一种Screen Space-Overlay它是完全以当前屏幕的像素大小创建的一个矩形范围，即控件是以屏幕坐标来绘制的；第二种Screen Space-Camera它是根据相机的视线范围来确定的一个矩形范围，其控件是根据Camera的ViewPortPoint坐标来绘制的;第三种从名称我们就可以知道，它是完全3D化的UI,使用的是常用的世界坐标。博主是刚开始研究UGUI,如果有不对的地方还希望大家能够原谅啊。好了，下面我们正式来做血条吧，在这里我们使用的是默认的Slider控件，用Slider控件来制作血条需要将Slider控件自带的滑块删除，然后我们通过改变value就可以实现一个简单的血条了。在UGUI中所有的图片素材都是以Sprite的形式来出现的，所以UGUI可以自己生成图集，不需要像NGUI在做UI前首先要生成图集。这是博主做的一个简单的血条。现在血条做好了，可是问题来了：这UGUI的所有控件都必须要放到Canvas下面啊，所以我们没法像NGUI一样直接把做好的血条放到怪物下面。怎么办呢？既然不能放到怪物下面，那我们就放到Canvas下面吧，不过我们需要自己计算血条的位置。好了，下面来看代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">public class Enemy : MonoBehaviour </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	//敌人的生命值</span><br><span class="line">	public float MaxHP;</span><br><span class="line">	public float HP;</span><br><span class="line"></span><br><span class="line">	//敌人的初始路径节点</span><br><span class="line">	public PathNode StartNode;</span><br><span class="line">	//敌人的移动速度</span><br><span class="line">	public float MoveSpeed=0.15F;</span><br><span class="line">	//敌人的旋转速度</span><br><span class="line">	public float RotateSpeed=0.3F;</span><br><span class="line"></span><br><span class="line">	//敌人血条预制件</span><br><span class="line">	public GameObject HPBar;</span><br><span class="line">	//敌人血条组件</span><br><span class="line">	private Slider mHPBar;</span><br><span class="line"></span><br><span class="line">	//public EnemySpawn mSpawn;</span><br><span class="line"></span><br><span class="line">	void Awake()</span><br><span class="line">	&#123;</span><br><span class="line">		//在敌人列表中增加一个敌人</span><br><span class="line">		GameManager.Instance.Enemys.Add(this.GetComponent&lt;Enemy&gt;());</span><br><span class="line">		//查找UI</span><br><span class="line">		Transform mUiRoot=GameObject.Find(&quot;UIManager&quot;).transform;</span><br><span class="line">		//计算血条位置</span><br><span class="line">		Vector3 mPos=this.transform.FindChild(&quot;EnemyHP&quot;).transform.position;</span><br><span class="line">		//mPos=Camera.main.WorldToViewportPoint(mPos);</span><br><span class="line">		mPos.z=-5;</span><br><span class="line">		//生成血条</span><br><span class="line">		GameObject go=(GameObject)Instantiate(HPBar,mPos,Quaternion.identity);</span><br><span class="line">		//使血条成为Canvas的子物体</span><br><span class="line">		go.transform.parent=mUiRoot;</span><br><span class="line">		//对血条进行放缩</span><br><span class="line">		go.GetComponent&lt;RectTransform&gt;().localScale=new Vector3(0.5F,0.30F,1);</span><br><span class="line">		//获取Slider</span><br><span class="line">		mHPBar=go.transform.GetComponent&lt;Slider&gt;();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	void Move()</span><br><span class="line">	&#123;</span><br><span class="line">		Vector3 mPos1=this.transform.position;</span><br><span class="line">		Vector3 mPos2=this.StartNode.transform.position;</span><br><span class="line">		//计算敌人与路径节点间的距离</span><br><span class="line">		float mDis=Vector2.Distance(new Vector2(mPos1.x,mPos1.y),new Vector2(mPos2.x,mPos2.y));</span><br><span class="line">		if(mDis&lt;0.1F)&#123;</span><br><span class="line">			if(StartNode.ThatNode==null)&#123;</span><br><span class="line">				//对防守阵地进行摧毁</span><br><span class="line">				GameManager.Instance.PlayerHP-=20;</span><br><span class="line">				//从敌人列表中移除自身</span><br><span class="line">				GameManager.Instance.Enemys.Remove(this);</span><br><span class="line">				//销毁自身</span><br><span class="line">				Destroy(this.gameObject);</span><br><span class="line">				//销毁血条</span><br><span class="line">				Destroy(mHPBar.gameObject);</span><br><span class="line">			&#125;else&#123;</span><br><span class="line">				StartNode=StartNode.ThatNode;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		//计算敌人的移动方向</span><br><span class="line">		Vector3 mDir=new Vector3(mPos2.x-mPos1.x,mPos2.y-mPos1.y,0).normalized;</span><br><span class="line">		transform.Translate(mDir * MoveSpeed * Time.deltaTime);</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">	void Rotate()</span><br><span class="line">	&#123;</span><br><span class="line">		//初始角度</span><br><span class="line">		float mStartAngle=this.transform.eulerAngles.z;</span><br><span class="line">		transform.LookAt(StartNode.transform);</span><br><span class="line">		//目标角度</span><br><span class="line">		float mTargetAngle=this.transform.eulerAngles.z;</span><br><span class="line">		//计算旋转量</span><br><span class="line">		float mAngle=Mathf.MoveTowardsAngle(mStartAngle,mTargetAngle,RotateSpeed *Time.deltaTime);</span><br><span class="line">		this.transform.eulerAngles = new Vector3(0,0,mAngle);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	void Update () </span><br><span class="line">	&#123;</span><br><span class="line">		Move();</span><br><span class="line">		UpdateHPBar();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void UpdateHPBar()</span><br><span class="line">	&#123;</span><br><span class="line">		//更新血条位置</span><br><span class="line">		Vector3 mPos=this.transform.FindChild(&quot;EnemyHP&quot;).transform.position;</span><br><span class="line">		//使血条位于顶层</span><br><span class="line">		mPos.z=-5;</span><br><span class="line">		mHPBar.transform.position=mPos;</span><br><span class="line">		//更新血量</span><br><span class="line">		mHPBar.value=(float)HP/MaxHP;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void SetDamage(int mValue)</span><br><span class="line">	&#123;</span><br><span class="line">		HP-=mValue;</span><br><span class="line">		if(HP&lt;=0)&#123;</span><br><span class="line">		  Destroy(this.gameObject);</span><br><span class="line">		  Destroy(mHPBar.gameObject);</span><br><span class="line">		  GameManager.Instance.Enemys.Remove(this.GetCopmonent&lt;Enemy&gt;());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在这里我们做了三件事情：</p>
<ul>
<li>第一，在Awake方法中我们首先计算出血条的位置然后在这个位置生成血条，并取得相关的变量备用。</li>
<li>第二，在Update方法中增加一个UpdateHPBar方法以实现对血条血量的更新。</li>
<li>第三，增加了一个SetDamage方法，当敌人血量为0时销毁自身、销毁血条、从敌人列表中移除敌人</li>
</ul>
<h2 id="敌人按波次进攻的实现"><a href="#敌人按波次进攻的实现" class="headerlink" title="敌人按波次进攻的实现"></a>敌人按波次进攻的实现</h2><p>好了，到现在为止，对于敌人的逻辑我们就全部实现了。可是我们知道在塔防游戏中敌人通常是一波一波出现的，所以我们需要一个敌人生成器EnemySpawn。那么，怎么来生成敌人呢，这里我们使用Xml文件来配置要生成的敌人列表，首先我们来构建一个Xml文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span> standalone=<span class="string">"yes"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">Enemies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"1"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"1"</span> <span class="attr">Wait</span>=<span class="string">"0.5"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"2"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"2"</span> <span class="attr">Wait</span>=<span class="string">"0.45"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"2"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"2"</span> <span class="attr">Wait</span>=<span class="string">"0.45"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"3"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"3"</span> <span class="attr">Wait</span>=<span class="string">"0.4"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"3"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"3"</span> <span class="attr">Wait</span>=<span class="string">"0.4"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"3"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"3"</span> <span class="attr">Wait</span>=<span class="string">"0.4"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"4"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"4"</span> <span class="attr">Wait</span>=<span class="string">"0.35"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"4"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"4"</span> <span class="attr">Wait</span>=<span class="string">"0.35"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"4"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"4"</span> <span class="attr">Wait</span>=<span class="string">"0.35"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"4"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"4"</span> <span class="attr">Wait</span>=<span class="string">"0.35"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"5"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"5"</span> <span class="attr">Wait</span>=<span class="string">"0.3"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"5"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"5"</span> <span class="attr">Wait</span>=<span class="string">"0.3"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"5"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"5"</span> <span class="attr">Wait</span>=<span class="string">"0.3"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"5"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"5"</span> <span class="attr">Wait</span>=<span class="string">"0.3"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"5"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"5"</span> <span class="attr">Wait</span>=<span class="string">"0.3"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Enemy</span> <span class="attr">Wave</span>=<span class="string">"6"</span> <span class="attr">EnemyName</span>=<span class="string">"Enemy"</span> <span class="attr">Level</span>=<span class="string">"99"</span> <span class="attr">Wait</span>=<span class="string">"0.15"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Enemies</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>从这个Xml文件中我们可以看到这样一个结构：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Xml;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class SpawnData </span><br><span class="line">&#123;</span><br><span class="line">	//敌人进攻波数</span><br><span class="line">	public int Wave;</span><br><span class="line">	///敌人名称，我们将根据这个名称来生成不同的敌人</span><br><span class="line">	public string EnemyName;</span><br><span class="line">	//敌人等级，我们将根据这个值来调整敌人的生命值和移动速度</span><br><span class="line">	public int Level;</span><br><span class="line"></span><br><span class="line">	public float Wait;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在SpawnData这个结构中，我们可以得到敌人攻击的波数、敌人的名称、敌人等级、敌人生成需要等待的时间，因为博主在游戏中只有一种敌人，所以敌人的名称都是一样的。好了，现在我们可以开始解析Xml了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//解析Xml文件</span><br><span class="line">void ReadXml()</span><br><span class="line">&#123;</span><br><span class="line">	//创建一个字典以存储敌人列表</span><br><span class="line">	mEnemyDatas=new List&lt;SpawnData&gt;();</span><br><span class="line">	//加载Xml文档</span><br><span class="line">	XmlDocument mDocument=new XmlDocument();</span><br><span class="line">	mDocument.LoadXml(ConfigFile.text);</span><br><span class="line">	XmlElement mRoot=mDocument.DocumentElement;</span><br><span class="line">	//解析Xml文档</span><br><span class="line">	XmlNodeList mNodes=mRoot.SelectNodes(&quot;/Enemies/Enemy&quot;);</span><br><span class="line">	foreach(XmlNode mNode in mNodes)</span><br><span class="line">	&#123;</span><br><span class="line">		//为每一个SpawnData赋值</span><br><span class="line">		SpawnData mData=new SpawnData();</span><br><span class="line">		mData.Wave=int.Parse(mNode.Attributes[0].Value);</span><br><span class="line">		mData.EnemyName=mNode.Attributes[1].Value;</span><br><span class="line">		mData.Level=int.Parse(mNode.Attributes[2].Value);</span><br><span class="line">		mData.Wait=float.Parse(mNode.Attributes[3].Value);</span><br><span class="line"></span><br><span class="line">		mEnemyDatas.Add(mData);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那么好了，在解析完Xml后我们得到了所有的敌人数据，接下来我们只需要按照顺序生成敌人就可以了。具体怎么做呢，我们知道在塔防游戏中生成敌人有两种情况：</p>
<ul>
<li>一个是要生成的敌人和当前敌人是同一波的，这种情况只要继续生成就好了。</li>
<li>一个是要生成的敌人的波数大于当前波数，这种情况需要等待这一波敌人被消灭完。</li>
</ul>
<p>好了，现在来写代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Xml;</span><br><span class="line"></span><br><span class="line">public class EnemySpawn : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">	//敌人寻路起点</span><br><span class="line">	public PathNode SpawnPath;</span><br><span class="line">	//敌人预制件</span><br><span class="line">	public GameObject Enemy;</span><br><span class="line">	//Xml文件</span><br><span class="line">	public TextAsset ConfigFile;</span><br><span class="line"></span><br><span class="line">	//存放敌人的数组</span><br><span class="line">	private List&lt;SpawnData&gt; mEnemyDatas;</span><br><span class="line"></span><br><span class="line">	//当前敌人进攻波数</span><br><span class="line">	private int mWave=0;</span><br><span class="line">	//当前敌人索引</span><br><span class="line">	private int mIndex=0;</span><br><span class="line">	//当前等待的时间</span><br><span class="line">	private float mWait;</span><br><span class="line"></span><br><span class="line">	void Start()</span><br><span class="line">	&#123;</span><br><span class="line">		//读取Xml数据</span><br><span class="line">		ReadXml();</span><br><span class="line">		Debug.Log(mEnemyDatas.Count);</span><br><span class="line">		//初始化攻击波数</span><br><span class="line">		SpawnData mData=mEnemyDatas[mIndex];</span><br><span class="line">		//设置攻击波数和等待时间</span><br><span class="line">		mWave=mData.Wave;</span><br><span class="line">		mWait=mData.Wait;</span><br><span class="line">		GameManager.Instance.AttackWave=mWave;</span><br><span class="line">		//生成第一个敌人</span><br><span class="line">		CreateEnemy(mData);</span><br><span class="line">		mIndex+=1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	void CreateEnemy(SpawnData mData)</span><br><span class="line">	&#123;</span><br><span class="line">		GameObject go=(GameObject)Instantiate(Enemy,SpawnPath.transform.position,Quaternion.identity);</span><br><span class="line">		Enemy _Enemy=go.GetComponent&lt;Enemy&gt;();</span><br><span class="line">		//根据Level计算敌人的生命值和移动速度</span><br><span class="line">		_Enemy.MaxHP= (float)mData.Level*0.25F * 100;</span><br><span class="line">		_Enemy.HP= (float)mData.Level*0.25F * 100;</span><br><span class="line">		go.GetComponent&lt;Enemy&gt;().MoveSpeed=(float)mData.Level * 0.15F;</span><br><span class="line">		go.GetComponent&lt;Enemy&gt;().StartNode=SpawnPath;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	void Update () </span><br><span class="line">	&#123;</span><br><span class="line">	   if(mIndex&lt;=mEnemyDatas.Count-1)&#123;</span><br><span class="line">	     SpawnEnemy();</span><br><span class="line">	   &#125;else</span><br><span class="line">		&#123;</span><br><span class="line">			//当索引数目大于敌人列表中的数目时，表示所有敌人以及生成完毕，此时</span><br><span class="line">			//如果所有的敌人都被消灭，则表示玩家获胜。</span><br><span class="line">			if(GameManager.Instance.Enemys.Count==0)&#123;</span><br><span class="line">				GameManager.Instance.IsWin=true;</span><br><span class="line">				Debug.Log(&quot;玩家胜&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void SpawnEnemy()</span><br><span class="line">	&#123;</span><br><span class="line">		//取得下一个生成的敌人的数据</span><br><span class="line">		SpawnData mData=mEnemyDatas[mIndex];</span><br><span class="line"></span><br><span class="line">		//开始计时</span><br><span class="line">		mWait-=Time.deltaTime;</span><br><span class="line">		if(mWait&lt;=0 )&#123;</span><br><span class="line">			//如果当前是同一波敌人，则继续生成敌人</span><br><span class="line">		    if(mWave==mData.Wave)&#123;</span><br><span class="line">			   //设置等待时间</span><br><span class="line">			   mWait=mEnemyDatas[mIndex].Wait;</span><br><span class="line">			   //设置进攻波数</span><br><span class="line">			   mWave=mEnemyDatas[mIndex].Wave;</span><br><span class="line">			   GameManager.Instance.AttackWave=mWave;</span><br><span class="line">			   //生成一个敌人</span><br><span class="line">			   if(mData!=null)&#123;</span><br><span class="line">			   CreateEnemy(mData);</span><br><span class="line">			   &#125;</span><br><span class="line">			   mIndex+=1;</span><br><span class="line">			&#125;//如果是下一波敌人，则需要等待这一波敌人全部死亡后再生成</span><br><span class="line">			else if(mWave&lt;mData.Wave &amp;&amp; GameManager.Instance.Enemys.Count==0)&#123;</span><br><span class="line">				//设置等待时间</span><br><span class="line">				mWait=mData.Wait;</span><br><span class="line">				//设置进攻波数</span><br><span class="line">				mWave=mData.Wave;</span><br><span class="line">				GameManager.Instance.AttackWave=mWave;</span><br><span class="line">				//生成一个敌人</span><br><span class="line">				CreateEnemy(mData);</span><br><span class="line">				mIndex+=1;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//解析Xml文件</span><br><span class="line">	void ReadXml()</span><br><span class="line">	&#123;</span><br><span class="line">		//创建一个字典以存储敌人列表</span><br><span class="line">		mEnemyDatas=new List&lt;SpawnData&gt;();</span><br><span class="line">		//加载Xml文档</span><br><span class="line">		XmlDocument mDocument=new XmlDocument();</span><br><span class="line">		mDocument.LoadXml(ConfigFile.text);</span><br><span class="line">		XmlElement mRoot=mDocument.DocumentElement;</span><br><span class="line">		//解析Xml文档</span><br><span class="line">		XmlNodeList mNodes=mRoot.SelectNodes(&quot;/Enemies/Enemy&quot;);</span><br><span class="line">		foreach(XmlNode mNode in mNodes)</span><br><span class="line">		&#123;</span><br><span class="line">			//为每一个SpawnData赋值</span><br><span class="line">			SpawnData mData=new SpawnData();</span><br><span class="line">			mData.Wave=int.Parse(mNode.Attributes[0].Value);</span><br><span class="line">			mData.EnemyName=mNode.Attributes[1].Value;</span><br><span class="line">			mData.Level=int.Parse(mNode.Attributes[2].Value);</span><br><span class="line">			mData.Wait=float.Parse(mNode.Attributes[3].Value);</span><br><span class="line"></span><br><span class="line">			mEnemyDatas.Add(mData);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们可以注意到，到现在为止敌人相关的内容博主都已经为大家讲解完了，这里博主和大家开了一个小玩笑，不知道大家有没有发现，在敌人的Xml配置文件中博主最后设计了一个等级为99级的敌人，哈哈，这个敌人在游戏中的特点大家要自己从代码中来探索了，大家可以按照博主的思路做出这个塔防游戏然后自己去试试看，相信大家会更加深刻地理解数值平衡的重要性吧！</p>
<h1 id="防守单位篇"><a href="#防守单位篇" class="headerlink" title="防守单位篇"></a>防守单位篇</h1><p>防守单位是塔防游戏中玩家可以支配和控制的一种资源，玩家通过合理地分布防守单位的位置来对玩家的防守阵地进行防御，当玩家的防守阵地被摧毁时玩家将无法继续部署防守单位。这就是防守单位在游戏中的主要作用。通常为了增加游戏的可玩性，游戏设计者往往会设计多种防守单位，在博主的这个小游戏中，我们只设计了一种防守单位，更多的防守单位的设计大家可以参考《保卫萝卜》和《植物大战僵尸》这两个游戏。好了，说了这么多，那么防守单位在整个塔防游戏中主要的作用是什么呢？答案就是防守，哈哈，这是一句不折不扣的废话。可是就是这样一句废话，却足以让我们知道防守单位需要对敌人进行自动攻击，这就要涉及到简单的AI算法了。好了，我们来看下面的脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class Defender : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">	//目标敌人</span><br><span class="line">	private Enemy mTarget;</span><br><span class="line">	//攻击半径</span><br><span class="line">	public float AttackArea=2.5F;</span><br><span class="line">	//与敌人的距离</span><br><span class="line">	private float mDistance=0;</span><br><span class="line">	//防守单位的旋转速度</span><br><span class="line">	public float RotateSpeed=1.5F;</span><br><span class="line">	//防守单位攻击间隔</span><br><span class="line">	public float AttakTime=2.5F;</span><br><span class="line">	//防守单位攻击间隔</span><br><span class="line">	private float mTime=0.0F;</span><br><span class="line"></span><br><span class="line">	//炮弹预设</span><br><span class="line">	public GameObject BulletObject;</span><br><span class="line"></span><br><span class="line">	void Start () </span><br><span class="line">	&#123;</span><br><span class="line">		//初始化防守单位攻击间隔</span><br><span class="line">		mTime=AttakTime;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//查找攻击范围内的敌人</span><br><span class="line">	void FindEnemy()</span><br><span class="line">	&#123;</span><br><span class="line">		//初始化目标敌人</span><br><span class="line">		mTarget=null;</span><br><span class="line">		//获取敌人列表</span><br><span class="line">		ArrayList mEnemys=GameManager.Instance.Enemys;</span><br><span class="line">		//遍历每个敌人</span><br><span class="line">		foreach(Enemy _enemy in mEnemys)</span><br><span class="line">		&#123;</span><br><span class="line">			//忽略生命值为0的敌人</span><br><span class="line">			if(_enemy.HP==0) continue;</span><br><span class="line">			//计算防守单位与敌人间的距离</span><br><span class="line">			Vector3 mPos1=transform.position;</span><br><span class="line">			Vector3 mPos2=_enemy.transform.position;</span><br><span class="line">			float mDis=Vector2.Distance(new Vector2(mPos1.x,mPos1.y),new Vector2(mPos2.x,mPos2.y));</span><br><span class="line">			if(mDis&gt;AttackArea)&#123;</span><br><span class="line">				//Debug.Log(&quot;敌人&quot; + _enemy.transform.name + &quot;未进入攻击范围,距离为:&quot; + mDis);</span><br><span class="line">				//return;</span><br><span class="line">			&#125;else&#123;</span><br><span class="line">				//Debug.Log(&quot;敌人&quot; + _enemy.transform.name + &quot;已进入攻击范围,距离为:&quot; + mDis);</span><br><span class="line">				//选择最近的敌人</span><br><span class="line">				if(mDistance==0 || mDistance &gt; mDis)&#123;</span><br><span class="line">					mTarget=_enemy;</span><br><span class="line">					mDistance=mDis;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				/*//选择生命值最低的敌人</span><br><span class="line">				if(mLife==0 || mLife &gt; _enemy.HP)&#123;</span><br><span class="line">					mTarget=_enemy;</span><br><span class="line">					mLife=_enemy.HP;</span><br><span class="line">				&#125;</span><br><span class="line">				*/</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		mDistance=0;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	void RotateTo()</span><br><span class="line">	&#123;</span><br><span class="line">		//判断目标敌人是否为空</span><br><span class="line">		if(mTarget==null) return;</span><br><span class="line">		//计算要旋转到敌人方向的角度</span><br><span class="line">		Vector3 mPos1=this.transform.position;</span><br><span class="line">		Vector3 mPos2=mTarget.transform.position;</span><br><span class="line">		Vector3 mDir=(mPos2-mPos1).normalized;</span><br><span class="line">		//使得两向量共面</span><br><span class="line">		mDir.z=0;</span><br><span class="line">		//计算两向量角度</span><br><span class="line">		float mAngle=getAngle(Vector3.up,mDir);</span><br><span class="line">		this.transform.eulerAngles=new Vector3(0,0,mAngle) * RotateSpeed;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//根据向量数学计算角度</span><br><span class="line">	private float getAngle(Vector3 v1,Vector3 v2)</span><br><span class="line">	&#123;</span><br><span class="line">		float mDot=Vector3.Dot(v1,v2);</span><br><span class="line">		float mv1=Mathf.Sqrt(v1.x*v1.x+v1.y*v1.y+v1.z*v1.z);</span><br><span class="line">		float mv2=Mathf.Sqrt(v2.x*v2.x+v2.y*v2.y+v2.z*v2.z);</span><br><span class="line">		if(v2.x&gt;v1.x)&#123;</span><br><span class="line">			return -Mathf.Acos(mDot/(mv1*mv2))* Mathf.Rad2Deg ;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			return Mathf.Acos(mDot/(mv1*mv2))* Mathf.Rad2Deg ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	void Attack()</span><br><span class="line">	&#123;</span><br><span class="line">		RotateTo();</span><br><span class="line">		if(mTarget==null) return;</span><br><span class="line">		//以下添加攻击逻辑</span><br><span class="line">		mTime-=Time.deltaTime;</span><br><span class="line">		if(mTime&lt;0)&#123;</span><br><span class="line">			Vector3 _angle=transform.Find(&quot;Bullet&quot;).eulerAngles;</span><br><span class="line">			Vector3 _pos=new Vector3(this.transform.position.x,this.transform.position.y,-2);</span><br><span class="line">			Instantiate(BulletObject,_pos,Quaternion.Euler(_angle));</span><br><span class="line">			mTime=AttakTime;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	void Update () </span><br><span class="line">	&#123;</span><br><span class="line">		FindEnemy();</span><br><span class="line">		Attack();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>防守单位的脚本定义在Defender这个类中，主要的行为有两个，即发现敌人后转向敌人、向敌人发射炮弹，这块的代码较为简单，大家自己去领会就好啦。我们知道在塔防游戏中玩家可以通过点击屏幕来自由地增加或移动防守单位，这部分的内容主要是和GUI相关的，因为目前博主对UGUI掌握地还不是很熟，所以就等以后博主有时间了再来补充吧！好了，这个塔防游戏的讲解教程就是这样了，希望大家能够喜欢，我知道大家等这篇下篇已经好久了，哈哈！<br><img src="http://img.blog.csdn.net/20150301190040972" alt="效果演示"><br>最后想说的是，博主的独立博客<a href="http://qinyuanpei.github.io">http://qinyuanpei.github.io</a>正式开始使用了，以后发表的文章会在独立博客和CSDN同时更新，希望大家能继续关注博主的博客！谢谢大家</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        <p><b>版权声明：</b>
        <a href="http://qinyuanpei.github.io/posts/1176959868/" rel="external">Unity3D塔防游戏开发项目讲解(下)</a>
        ，由&nbsp;<a href="/about" target="_blank" rel="external">Payne</a>&nbsp;
        首次发表于&nbsp;<a href="/" target="_blank" rel="external">Payne's Blog</a>&nbsp;
        ，本文地址为：<a href="http://qinyuanpei.github.io/posts/1176959868/" target="_blank" rel="external">http://qinyuanpei.github.io/posts/1176959868/</a>
        ，转载请注明<b>作者</b>和<b>出处</b>。</p>
    </div>
    <footer>
        <a href="http://qinyuanpei.github.io">
            <img src="/assets/images/avatar.jpg" alt="Payne">
            Payne
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/塔防/">塔防</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/游戏开发/">游戏开发</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://qinyuanpei.github.io/posts/1176959868/&title=《Unity3D塔防游戏开发项目讲解(下)》 — Payne's Blog&pic=http://qinyuanpei.github.ioassets/images/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://qinyuanpei.github.io/posts/1176959868/&title=《Unity3D塔防游戏开发项目讲解(下)》 — Payne's Blog&source=各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://blog.csdn.net/qinyuanpei。我们知道一个完整的塔防游..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://qinyuanpei.github.io/posts/1176959868/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Unity3D塔防游戏开发项目讲解(下)》 — Payne's Blog&url=http://qinyuanpei.github.io/posts/1176959868/&via=http://qinyuanpei.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://qinyuanpei.github.io/posts/1176959868/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/posts/906436376/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">当Unity3D游戏开发遇上Excel</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/posts/123663202/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">剑指Offer读书笔记(1)</h4>
      </a>
    </div>
  
</nav>



    
    <div id="comment"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script type="text/javascript">
new Valine({
    el: '#comment' ,
    notify:false, 
    verify:false, 
    appId: 'JbHqRp2eMrTgIwYpfERH0g79-gzGzoHsz',
    appKey: 'VsiKvLuiBGvJL1XrAfv7siY2',
    placeholder: '',
    path:'1176959868', 
    avatar:'mm' 
});
</script>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        赠人玫瑰，手有余香
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/assets/images/geizan.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/assets/images/geizan.jpg" data-alipay="/assets/images/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>
                <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="license">
                    BY-NC-SA
                </a>
            </span>
            <span>
                <a href="https://www.travis-ci.org/qinyuanpei/qinyuanpei.github.io" rel="license">
                    Travis CI
                </a>
            </span>
            <span>
                <a href="https://github.com/qinyuanpei/qinyuanpei.github.io" rel="license">
                    Github
                </a>
            </span>
            <span>
                <a href="https://coding.net/u/qinyuanpei/p/qinyuanpei.coding.me" rel="license">
                    Coding
                </a>
            </span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Payne &copy; 2014 - 2018</span>
            <span>
                
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://qinyuanpei.github.io/posts/1176959868/&title=《Unity3D塔防游戏开发项目讲解(下)》 — Payne's Blog&pic=http://qinyuanpei.github.ioassets/images/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://qinyuanpei.github.io/posts/1176959868/&title=《Unity3D塔防游戏开发项目讲解(下)》 — Payne's Blog&source=各位朋友，大家好，我是秦元培，欢迎大家关注我的博客，我的博客地址是http://blog.csdn.net/qinyuanpei。我们知道一个完整的塔防游..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://qinyuanpei.github.io/posts/1176959868/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Unity3D塔防游戏开发项目讲解(下)》 — Payne's Blog&url=http://qinyuanpei.github.io/posts/1176959868/&via=http://qinyuanpei.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://qinyuanpei.github.io/posts/1176959868/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://qinyuanpei.github.io/posts/1176959868/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.6/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/assets/scripts/main.min.js?v=1.7.1"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/assets/scripts/search.min.js?v=1.7.1" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
